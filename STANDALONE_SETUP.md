# Автономный запуск бэкенда

Этот документ описывает, как запустить бэкенд приложения "Антракт" в автономном режиме, без ожидания Docker контейнеров с PostgreSQL и MinIO.

## Особенности автономного режима

Бэкенд теперь может работать в гибком режиме:

### База данных
- **PostgreSQL** (если доступен на localhost:5432)
- **SQLite** (fallback, если PostgreSQL недоступен)

### Хранение файлов
- **MinIO** (если доступен на localhost:9000)
- **Локальное хранение** (fallback, если MinIO недоступен)

## Скрипты запуска

### Windows

#### Batch скрипт
```bash
start_windows_standalone.bat
```

#### PowerShell скрипт
```powershell
.\start_windows_standalone.ps1
```

### Linux/Mac

```bash
./start_standalone.sh
```

## Что происходит при запуске

1. **Проверка Python** - убеждается, что Python установлен
2. **Создание/активация виртуального окружения**
3. **Установка зависимостей** из requirements.txt
4. **Проверка доступности сервисов**:
   - PostgreSQL (localhost:5432)
   - MinIO (localhost:9000)
5. **Применение миграций** на доступную БД
6. **Инициализация MinIO** (если доступен)
7. **Запуск Django сервера**

## Логи при запуске

При запуске вы увидите сообщения о том, какие сервисы используются:

```
✓ Используется PostgreSQL: localhost:5432
✓ MinIO доступен: localhost:9000
```

Или в случае fallback:

```
⚠ PostgreSQL недоступен, используется SQLite
  Проверьте подключение к localhost:5432
⚠ MinIO недоступен: localhost:9000
  Будет использоваться локальное хранение файлов
```

## Доступные сервисы

После успешного запуска будут доступны:

- **Django API**: http://localhost:8000
- **Swagger API Docs**: http://localhost:8000/swagger/

Опциональные (если сервисы запущены):
- **MinIO Console**: http://localhost:9001 (minioadmin/minioadmin123)
- **PostgreSQL**: localhost:5432

## Изменения в коде

### settings.py
- Добавлена автоматическая проверка доступности PostgreSQL
- Fallback на SQLite при недоступности PostgreSQL
- Проверка доступности MinIO с флагом USE_MINIO

### init_minio.py
- Убрано ожидание запуска MinIO
- Graceful fallback при недоступности MinIO
- Уменьшено количество попыток подключения

### docker-compose.yml
- Закомментированы жесткие зависимости depends_on
- Бэкенд может запускаться независимо от других сервисов

## Для разработчиков

Если вы хотите использовать полный стек с PostgreSQL и MinIO:

1. Запустите Docker контейнеры:
   ```bash
   docker-compose up postgres minio -d
   ```

2. Затем запустите автономный скрипт - он автоматически обнаружит и использует эти сервисы

## Устранение неполадок

### Python не найден
Установите Python 3.8+ и убедитесь, что он доступен в PATH

### Ошибки миграций
- При использовании SQLite: миграции применятся автоматически
- При использовании PostgreSQL: убедитесь, что БД запущена и доступна

### Проблемы с MinIO
- Приложение будет работать с локальным хранением файлов
- Для полной функциональности запустите MinIO отдельно

### Порты заняты
- Django: измените порт в команде `python manage.py runserver 0.0.0.0:ПОРТ`
- PostgreSQL/MinIO: измените настройки в переменных окружения или .env файле